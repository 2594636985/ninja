<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2013-11-13
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20131113" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja Web Framework | Full stack web framework for Java. Fast and productive. Built on Maven - runs on servlet containers. - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38154034-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();</script>
          
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href=".././" id="bannerLeft">
                <h2>Ninja web framework</h2>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-11-13</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 2.2.0</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header"></li>
                                
      <li>
    
                          <a href="../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../introduction.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="../team.html" title="Team">
          <i class="none"></i>
        Team</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="../documentation/getting_started.html" title="Documentation">
          <i class="icon-chevron-down"></i>
        Documentation</a>
                    <ul class="nav nav-list">
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>Controller</a>
          </li>
                      
      <li>
    
                          <a href="../documentation/injection.html" title="Injection">
          <i class="none"></i>
        Injection</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/html_templating.html" title="Html templating">
          <i class="none"></i>
        Html templating</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/static_assets.html" title="Static assets">
          <i class="none"></i>
        Static assets</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/request_scope.html" title="Request scope">
          <i class="none"></i>
        Request scope</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/internationalization.html" title="Internationalization">
          <i class="none"></i>
        Internationalization</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/filter.html" title="Filter">
          <i class="none"></i>
        Filter</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/application_configuration.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/jpa.html" title="JPA / DB">
          <i class="none"></i>
        JPA / DB</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/db_migrations.html" title="DB Migrations">
          <i class="none"></i>
        DB Migrations</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/cache.html" title="Caching">
          <i class="none"></i>
        Caching</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/lifecycle.html" title="Lifecycle">
          <i class="none"></i>
        Lifecycle</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/scheduler.html" title="Scheduler">
          <i class="none"></i>
        Scheduler</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/testing.html" title="Testing">
          <i class="none"></i>
        Testing</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/security_guide.html" title="Security Guide">
          <i class="none"></i>
        Security Guide</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/debugging.html" title="Debugging">
          <i class="none"></i>
        Debugging</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/servlet_bridge.html" title="Servlet bridge">
          <i class="none"></i>
        Servlet bridge</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/upgrading_to_current_version.html" title="Upgrading to latest">
          <i class="none"></i>
        Upgrading to latest</a>
            </li>
                      
      <li>
    
                          <a href="../apidocs/index.html" title="API">
          <i class="none"></i>
        API</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="../documentation/modules.html" title="Modules">
          <i class="none"></i>
        Modules</a>
            </li>
                              <li class="nav-header">Get involved</li>
                                
      <li>
    
                          <a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework">
          <i class="none"></i>
        @ninjaframework</a>
            </li>
                  
      <li>
    
                          <a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list">
          <i class="none"></i>
        Mailing list</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code">
          <i class="none"></i>
        Source code</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker">
          <i class="none"></i>
        Bug tracker</a>
            </li>
                  
      <li>
    
                          <a href="../security.html" title="Security issues">
          <i class="none"></i>
        Security issues</a>
            </li>
                              <li class="nav-header">Develop</li>
                                
      <li>
    
                          <a href="../developer/changelog.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                  
      <li>
    
                          <a href="../developer/roadmap.html" title="Roadmap">
          <i class="none"></i>
        Roadmap</a>
            </li>
                  
      <li>
    
                          <a href="../developer/getting_started.html" title="How to contribute">
          <i class="none"></i>
        How to contribute</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Controller</h1><p>Controller are the &ldquo;C&rdquo; in the MVC paradigm.</p><p>As almost everything else in Ninja a controller in Ninja is just a simple
Java class that follows some little conventions.</p><h2>A really simple controller</h2><p>A really simple controller would look like:</p>
<pre class="prettyprint">
    package controllers;

    @Singleton
    public class ApplicationController {
        
        public Result index() {
        
            return Results.html();
        }


    }
</pre><p>The important conventions are that a controller method must return a &ldquo;Result&rdquo;. A result
is in short just an object that holds response codes, content to render, headers and cookies
that should be returned to the visitors of your website.</p><p>Results with the &ldquo;s&rdquo; at the end is a convenience class that allows you to generate a configured result.
For instance Results.html() will tell Ninja to render a html page. There is also Results.json().</p><p>By convention controllers live in the package &ldquo;controllers&rdquo;.</p><h2>Getting parameters into your controllers</h2><p>A controller usually not only renders stuff, but also takes some inputs and does something with them.</p><p>Let&rsquo;s say we got a route like that:
<pre class="prettyprint">
 router.GET().route(&ldquo;/user/{id}/{email}/userDashboard&rdquo;).with(ApplicationController.class, &ldquo;userDashboard&rdquo;);
</pre></p><p>&hellip; and the user visits that Url&hellip;</p>
<pre class="prettyprint">  
    /user/12345/my@email.com/userDashboard?debug=false
</pre><p>We then of course want to know <strong>id</strong>, <strong>email</strong> and the value of the <strong>debug</strong> query parameter.</p><p>In Ninja this is really simple and controller that can do so looks like:</p>
<pre class="prettyprint">
    package controllers;

    @Singleton
    public class ApplicationController {
        
        public Result index(
                @PathParam("id") String id, 
                @PathParam("email") String email, 
                @Param("debug") String debug) {
                
            //do something with the parameters...
        }


    }
</pre><p>Method index now gets the contents of the path parameters and all query parameters.</p><h2>More on objects Ninja can automatically provide you at controller level</h2><p>Have a look at that method:</p>
<pre class="prettyprint">
    package controllers;

    @Singleton
    public class ApplicationController {
        
        public Result index(
                @PathParam("id") String id, 
                @PathParam("email") String email, 
                @Param("debug") String debug,
                Context context,
                MyObject myObject) {
                
            //do something with the parameters...
        }

    }
</pre><p>Ninja can not only inject PathParam and Param objects. But also the Context.
The context is a request scoped object that holds all informations of the current
request - parameters, headers and so on&hellip;</p><p>Even better: Ninja will parse an arbitrary object given in the method.
In the above case MyObject will be automatically parsed by Ninja. The way
it will parsed (Json, Xml, PostForm) will be determined via the request type.</p><p>Therefore you don&rsquo;t have to worry if
input is for instance Xml or Json. You simply get a parsed object.</p><h2>Injecting stuff into your controller method (method scope)</h2><p>Ninja can inject a lot of stuff into your methods. And you can customize that easily yourself by using so
called ArgumentExtractors.</p><p>ArgumentExtractors allow you to inject arbitrary things into the method of a controller.</p><p>Have a look at the following method:</p>
<pre class="prettyprint">
    package controllers;

    @Singleton
    public class ApplicationController {
        
        public Result index(
                @LoggedInUser String loggedInUser) {
                
            //do something with the parameters...
        }

    }
</pre><p>The @LoggedInUser is a so called ArgumentExtractors and allow you to extract arbitrary things out
of the request and re-package them into anything you want. @LoggedInUser for instance determines
the user and injects the username into the field annotated with @LoggedInUser.</p><p>ArgumentMatchers therefore consist of two things.</p><p>First the marker interface:</p>
<pre class="prettyprint">
    @WithArgumentExtractor(LoggedInUserExtractor.class)
    @Retention(RetentionPolicy.RUNTIME)
    @Target({ElementType.PARAMETER})
    public @interface LoggedInUser {}
</pre><p>&hellip; and the ArgumentExtractor itself:</p>
<pre class="prettyprint">
public class LoggedInUserExtractor implements ArgumentExtractor<String> {

    @Override
    public String extract(Context context) {
        
        // if we got no cookies we break:
        if (context.getSessionCookie() != null) {
            
            String username = context.getSessionCookie().get("username");
            
            return username;
            
        }
        
        return null;
    }

    @Override
    public Class getExtractedType() {
        return String.class;
    }

    @Override
    public String getFieldName() {
        return null;
    }
}
</pre><p>As you can see the interface for the ArgumentExtractor references @WithArgumentExtractor(LoggedInUserExtractor.class).
LoggedInUserExtractor itself has full access to the context (and the incoming request) and will return the object
annotated initially by @LoggedInUser. In our example this was @LoggedInUser String loggedInUser.</p><h2>Reverse routing</h2><p>Let&rsquo;s say you want to know the final route of a class ApplicationController.class, method &ldquo;index&rdquo;. Assume
that the original raw route looked like a simple <code>&ldquo;/&rdquo;</code>.</p><p>You can get the final url by injecting the router into your controller and then calling getReverseRoute</p>
<pre class="prettyprint">
    @Inject
    Router router;
        
    ...
        
    public void myMethod() {
        
        // will result into "/"
        String generatedReverseRoute 
            = router.getReverseRoute(
                ApplicationController.class, 
                "index");
        
        ...
    }       
</pre><p>Now consider a more complex example. Say the original raw route contained placeholders on the following form:
<code>/user/{id}/{email}/userDashboard</code>. You can now ask the router for the final url, but you must
provide a map containing mappings from placeholders to final values. If the key cannot be found as
placeholders their value will be added as query parameters:</p>
<pre class="prettyprint">
    @Inject
    Router router;
    
    ...
    
    public void myMethod() {
    
        map = Maps.newHashMap();
        map.put("id","myId");
        map.put("email","myEmail");
        map.put("paging_size","100");
        map.put("page","1");
    
        // this will result into "/user/myId/myEmail/userDashboard?paging_size=100&page=1"
        String generatedReverseRoute 
            = router.getReverseRoute(
                ApplicationController.class, 
                "userDashboard", 
                map);

        ...
    }       
</pre><h2>Rendering html</h2><p>Rendering by convention has been already explained in the getting started part. But in short consider the
following class:</p>
<pre class="prettyprint">
    package controllers;

    public class ApplicationController {       
    
        public Result index() {
            return Results.html();
    
        }
    }
</pre><p>This renders by convention a view in directory <strong>views/ApplicationController/index.ftl.html</strong>.</p><p>But you can specify your own html view, too:</p>
<pre class="prettyprint">
    package controllers;

    public class ApplicationController {       
    
        public Result index() {
            return Results.html().template("views/AnotherController/anotherview.ftl.html");
    
        }
    }
</pre><p>In conclusion you can use convention over configuration in most cases - but you can also specify
a view to render explicitly.</p><h2>Rendering Json</h2><p>Consider this simple model class:</p>
<pre class="prettyprint">
    package models;

    public class Person {       
    
        String name;
    }
    
</pre><p>And this controller:</p>
<pre class="prettyprint">
    package controllers;

    public class ApplicationController {       
    
        public Result index() {
        
            Person person = new Person();
            person.name = "John Johnson";
        
            return Results.json().render(person);
    
        }
    }
</pre><p>This controller will produce a nicely formatted Json output for you. Under the hood
Ninja uses Jackson to transform arbitrary objects into Json.</p><h2>Rendering JsonP</h2><p>Use the same approach as for Json to produce JsonP (Json wrapped by Javascript function call):</p>
<pre class="prettyprint">
    Results.jsonp().render(person);
</pre><p>Parameter named <strong>callback</strong> should hold the name of the Javascript function or object path with function name (for example, <strong>?callback=MyApp.Path.myCallback123</strong>):</p>
<pre class="prettyprint">
    MyApp.Path.myCallback123({'response': 'data'})
</pre><p>The name of the GET parameter (&ldquo;callback&rdquo; is default) can be changed by <strong>ninja.jsonp.callbackParameter</strong> property in <strong>application.conf</strong>.</p><h2>Rendering Xml</h2><p>This is almost exactly the same as rendering Json.
Let&rsquo;s use again a simple Person Pojo:</p><p>Consider this simple model class:</p>
<pre class="prettyprint">
    package models;

    public class Person {       
    
        String name;
    }
    
</pre><p>Rendering is done by using Results.xml.render(&hellip;) like so:</p>
<pre class="prettyprint">
    package controllers;

    public class ApplicationController {       
    
        public Result index() {
        
            Person person = new Person();
            person.name = "John Johnson";
        
            return Results.xml().render(person);
    
        }
    }
</pre><p>As in the case we are using Jackson under the hood the does the transformation work.</p><h2>A note on encoding / decoding</h2><p>Encoding / Decoding of Urls is not as easy as you think it is. Ninja tries to simplify everything
as much as possible, but as user of the Api you have to know what you are submitting to Ninja.</p><p>We recommend the following <a href="http://www.lunatech-research.com/archives/2009/02/03/what-every-web-developer-must-know-about-url-encoding">excellent article from Lunatech</a>
before you use encoding / decoding actively in your application.</p><p>Let&rsquo;s reconsider the controller method from above:</p>
<pre class="prettyprint">
    package controllers;

    @Singleton
    public class ApplicationController {
        
        public Result index(
                @PathParam("id") String id, 
                @PathParam("email") String email, 
                @Param("debug") String debug) {
                
            //do something with the parameters...
        }

    }
</pre><p>You can expect that String <strong>id</strong> and String <strong>debug</strong> are both correctly decoded values. <strong>BUT</strong> This assumes that
you are encoding the values correctly on the client side. And encoding is different for
query parameters or stuff in the path. And not - do not even think about using URLEncoder for encoding urls. This
is wrong.</p><p>Simple example that outlines some of the difficulties:
Think of a route &ldquo;/user/{id}/userDashboard&rdquo;.</p><p>Let&rsquo;s say your <strong>id</strong> is &ldquo;rootuser/domain&rdquo;. If you do not encode the slash in the middle you end up with a
url like /user/rootuser/domain/userDashboard. And the this url does not match the route
because of the &ldquo;/&rdquo;.</p><p>Therefore you have to encode your id correctly. In that case it would be: rootuser%2Fdomain.
When the user then visits /user/rootuser%2Fdomain/userDashboard the route matches and
a @PathParam(&ldquo;id&rdquo;) would then be rootuser/domain as it is decoded by Ninja.</p><p>In principle it is really simple. But it is even simpler to mess encoding / decoding up.
The article from Lunatech mentioned earlier is awesome and explains everything.</p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
