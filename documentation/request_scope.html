<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at May 7, 2013
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ninja Web Framework | Full stack web framework for Java. Fast and productive. Built on Maven - runs on servlet containers. - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

          
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38154034-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();</script>
          
    <meta name="Date-Revision-yyyymmdd" content="20130507" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/reyez/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 100;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../.." id="bannerLeft">
                <h2>Ninja web framework</h2>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-05-07</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.4.1</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3></h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="../introduction.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="../team.html" title="Team">Team</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                            <li class="expanded">
                          <a href="../documentation/getting_started.html" title="Documentation">Documentation</a>
                    <ul>
                      <li class="none">
                          <a href="../documentation/controller.html" title="Controller">Controller</a>
            </li>
                      <li class="none">
                          <a href="../documentation/application_configuration.html" title="Configuration">Configuration</a>
            </li>
                      <li class="none">
                          <a href="../documentation/html_templating.html" title="Html templating">Html templating</a>
            </li>
                      <li class="none">
                          <a href="../documentation/static_assets.html" title="Static assets">Static assets</a>
            </li>
                      <li class="none">
                          <a href="../documentation/injection.html" title="Injection">Injection</a>
            </li>
                      <li class="none">
                          <a href="../documentation/filter.html" title="Filter">Filter</a>
            </li>
                      <li class="none">
                          <a href="../documentation/internationalization.html" title="Internationalization">Internationalization</a>
            </li>
                      <li class="none">
            <strong>Request scope</strong>
          </li>
                      <li class="none">
                          <a href="../documentation/scheduler.html" title="Scheduler">Scheduler</a>
            </li>
                      <li class="none">
                          <a href="../documentation/lifecycle.html" title="Lifecycle">Lifecycle</a>
            </li>
                      <li class="none">
                          <a href="../documentation/validation.html" title="Validation">Validation</a>
            </li>
                      <li class="none">
                          <a href="../documentation/servlet_bridge.html" title="Servlet bridge">Servlet bridge</a>
            </li>
                      <li class="none">
                          <a href="../documentation/debugging.html" title="Debugging">Debugging</a>
            </li>
                      <li class="none">
                          <a href="../documentation/deployment.html" title="Deployment">Deployment</a>
            </li>
                      <li class="none">
                          <a href="../documentation/upgrading_to_current_version.html" title="Upgrading to latest">Upgrading to latest</a>
            </li>
                      <li class="none">
                          <a href="../apidocs/index.html" title="API">API</a>
            </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="../documentation/modules.html" title="Modules">Modules</a>
            </li>
          </ul>
                        <h3>Get involved</h3>
                  <ul>
                  <li class="none">
                          <a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework">@ninjaframework</a>
            </li>
                  <li class="none">
                          <a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list">Mailing list</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/reyez/ninja" class="externalLink" title="Source code">Source code</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/reyez/ninja/issues" class="externalLink" title="Bug tracker">Bug tracker</a>
            </li>
                  <li class="none">
                          <a href="../security.html" title="Security issues">Security issues</a>
            </li>
          </ul>
                        <h3>Develop</h3>
                  <ul>
                  <li class="none">
                          <a href="../developer/changelog.html" title="Changelog">Changelog</a>
            </li>
                  <li class="none">
                          <a href="../developer/roadmap.html" title="Roadmap">Roadmap</a>
            </li>
                  <li class="none">
                          <a href="../developer/getting_started.html" title="How to contribute">How to contribute</a>
            </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Request scope facilities</h1><p>Http is all about the request. Ninja offers some facilities to handle stuff you have to
do during a request scope. Authentication, and generating objects for a single request are
common examples. The three major players here are:</p>
<ul>
  <li>Filters that add values as attributes to the context</li><li>Filters that wrap a context and add / remove stuff from the context.</li><li>ArgumentExtractors, that allow to inject arbitrary objects into a controller.</li>
</ul><h2>Attributes in Contexts</h2><p>Filters work in a chained manner. At the end you usually call filterChain.next(context) to continue
the filtering.</p><p>This is cool, because it offers you the possibility to inject objects into the context for future
use by other filters down the chain or the leaf controller.</p>
<pre class="prettyprint">

    //////////////////////////////////////////////////////////////////////////
    // do some stuff like connecting to your database and verifying the user.
    //////////////////////////////////////////////////////////////////////////
    UserInfo userInfo = …; // a complex object, e.g. retrieved from database
    context.setAttribute("userinfo", userInfo);
    
</pre><p>Then in the controller:</p>
<pre class="prettyprint">

    UserInfo userInfo = context.getAttribute("userinfo", UserInfo.class);
    
</pre><p>or even simpler, you can get the <code>UserInfo</code> injected into your controller method&rsquo;s arguments with
<code>@Attribute(&quot;userinfo&quot;) UserInfo userInfo</code>.</p><p>Context attributes are very similar to <code>ServletRequest</code>&rsquo;s attribute, and are implement as such in
<code>ninja-servlet</code>.</p><h2>WrappedContext in Filters</h2><p>Filters also offers you the possibility to replace and partly overwrite the context
with your own context. You can possibly even extend the Context with your own methods and
functions. A good starting point is the class <code>WrappedContext</code> of Ninja.</p><p>The following example allows you to inject an arbitrary parameter in the filter chain. This is helpful
if you want to authorize that user by setting (or not setting) the email as parameter.</p>
<pre class="prettyprint">

    //////////////////////////////////////////////////////////////////////////
    // do some stuff like connecting to your database and verifying the user.
    //////////////////////////////////////////////////////////////////////////
    final username = "MyUserName";

    public class WrappedContextFilter implements Filter {

        @Override
        public Result filter(FilterChain filterChain, Context context) {
        
            WrappedContext wrappedContext = new WrappedContext(context) {
            
                // Override the getParameter function of the context.
                // This lets you inject parameters in your controller via @Param("username")
                // But also have a look at ArgumentExtractors. Maybe they are a cleaner solution
                // to your problem :)
                public String getParameter(String key) {
                
                    if (key.equals("username")) {
                    
                        return username;
                    } else {
                    
                        return getParameter(key);
                    }
                
                }            
            };
        
            // Simply continue the chain with the wrapped context
            return filterChain.next(wrappedContext);
        }
  
    }
    
</pre><p>You can then use a simple <code>@Param(&quot;username&quot;)</code> to inject the username of your wrapped context into the controller:</p>
<pre class="prettyprint">

    @FilterWith(WrappedContextFilter.class)
    public Result index(@Param("username") String username) {
    
        // Usually you would do some authentication or error handling with
        // username...
        logger.log("username: " + username); //this will be MyUserName

        return Results.html();

    }
    
</pre><h2>Argument Extractors</h2><p>Injecting stuff into your controller via </p>
<pre class="prettyprint">

    public Result index(@Param("username") String username) { ... }
    
</pre><p>is really nice, but what about creating your own annotations for custom controller injections?
Well. This is pretty simple and can be accomplished by Ninja&rsquo;s <code>ArgumentExtractors</code>. <code>@Param</code> is also
just an <code>ArgumentExtractor</code> by the way.</p><p>Let&rsquo;s say we want to inject a User object into our controller based on e.g. logged in status.
First you have to define your own annotation interface like so:</p>
<pre class="prettyprint">

    @WithArgumentExtractor(LoggedInUserExtractor.class)
    @Retention(RetentionPolicy.RUNTIME)
    @Target({ ElementType.PARAMETER })
    public @interface LoggedInUser {
        // Just a marker interface
    }
    
</pre><p>You can of course also use annotations with values like in <code>@Param</code>. But we want keep things simple for now.
The next step is to write your own <code>ArgumentExtractor</code> for your <code>User</code> object:</p>
<pre class="prettyprint">

    public class LoggedInUserExtractor implements ArgumentExtractor&#60;User&#62; {

        @Override
        public User extract(Context context) {                    
            //////////////////////////////////////////////////////////////////
            // Usually you would now extract stuff from the context
            // and contact your db to check if user is authenticated or so...        
            ///////////////////////////////////////////////////////////////////
            User user = new User();
            user.email = "user@example.com";
            return user;
        }

        @Override
        public Class&#60;User&#62; getExtractedType() {
            return User.class;
        }

        @Override
        public String getFieldName() {
            return null;
        }
    }
    
</pre><p>And then you can simply use that extractor as annotation in your controller to inject a user during a request:</p>
<pre class="prettyprint">

    public Result index(@LoggedInUser User user) {
    
        System.out.println("user's email: " + user.email); //will be user@example.com
        // Usually you want to do some more complex logic here...

        return Results.html();

    }
    
</pre><p>That&rsquo;s almost everything you have to know about <code>ArgumentExtractors</code>. They really facilitate injection of arbitrary objects into
your controller during a request.</p>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
