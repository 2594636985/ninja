<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2013-11-29
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20131129" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja Web Framework | Full stack web framework for Java. Fast and productive. Built on Maven - runs on servlet containers. - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38154034-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();</script>
          
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href=".././" id="bannerLeft">
                <h2>Ninja web framework</h2>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-11-29</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 2.3.0</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header"></li>
                                
      <li>
    
                          <a href="../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../introduction.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="../team.html" title="Team">
          <i class="none"></i>
        Team</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="../documentation/getting_started.html" title="Documentation">
          <i class="icon-chevron-down"></i>
        Documentation</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/controller.html" title="Controller">
          <i class="none"></i>
        Controller</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/injection.html" title="Injection">
          <i class="none"></i>
        Injection</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/html_templating.html" title="Html templating">
          <i class="none"></i>
        Html templating</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/static_assets.html" title="Static assets">
          <i class="none"></i>
        Static assets</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/request_scope.html" title="Request scope">
          <i class="none"></i>
        Request scope</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/internationalization.html" title="Internationalization">
          <i class="none"></i>
        Internationalization</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/filter.html" title="Filter">
          <i class="none"></i>
        Filter</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/application_configuration.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/jpa.html" title="JPA / DB">
          <i class="none"></i>
        JPA / DB</a>
            </li>
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>DB Migrations</a>
          </li>
                      
      <li>
    
                          <a href="../documentation/cache.html" title="Caching">
          <i class="none"></i>
        Caching</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/lifecycle.html" title="Lifecycle">
          <i class="none"></i>
        Lifecycle</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/scheduler.html" title="Scheduler">
          <i class="none"></i>
        Scheduler</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/testing.html" title="Testing">
          <i class="none"></i>
        Testing</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/security_guide.html" title="Security Guide">
          <i class="none"></i>
        Security Guide</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/super_dev_mode.html" title="SuperDevMode">
          <i class="none"></i>
        SuperDevMode</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/debugging.html" title="Debugging">
          <i class="none"></i>
        Debugging</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/servlet_bridge.html" title="Servlet bridge">
          <i class="none"></i>
        Servlet bridge</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/upgrading_to_current_version.html" title="Upgrading to latest">
          <i class="none"></i>
        Upgrading to latest</a>
            </li>
                      
      <li>
    
                          <a href="../apidocs/index.html" title="API">
          <i class="none"></i>
        API</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="../documentation/modules.html" title="Modules">
          <i class="none"></i>
        Modules</a>
            </li>
                              <li class="nav-header">Get involved</li>
                                
      <li>
    
                          <a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework">
          <i class="none"></i>
        @ninjaframework</a>
            </li>
                  
      <li>
    
                          <a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list">
          <i class="none"></i>
        Mailing list</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code">
          <i class="none"></i>
        Source code</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker">
          <i class="none"></i>
        Bug tracker</a>
            </li>
                  
      <li>
    
                          <a href="../security.html" title="Security issues">
          <i class="none"></i>
        Security issues</a>
            </li>
                              <li class="nav-header">Develop</li>
                                
      <li>
    
                          <a href="../developer/changelog.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                  
      <li>
    
                          <a href="../developer/roadmap.html" title="Roadmap">
          <i class="none"></i>
        Roadmap</a>
            </li>
                  
      <li>
    
                          <a href="../developer/getting_started.html" title="How to contribute">
          <i class="none"></i>
        How to contribute</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Database Migrations</h1><p>When you are using relational databases you need to track and organize schema evolutions.</p><p>This becomes increasingly important when many people are collaborating on one code base and also
when you want to consistently upgrade your production database.</p><p>To that end Ninja integrates the excellent Flyway migration tool (<a href="http://flywaydb.org/)">http://flywaydb.org/)</a>.</p><h1>Configuring migrations in Ninja</h1><p>Activate migrations by setting the following property:</p>
<pre class="prettyprint">
ninja.migration.run=true
</pre><p>Then set the credentials for your database:</p>
<pre class="prettyprint">
db.connection.url=jdbc:postgresql://localhost:5432/ra
db.connection.username=ra
db.connection.password=
</pre><h1>Setting up Flyway</h1><p>Flyway itself manages database migration scripts in a directory called db/migrations. You should use
the following naming convention: <code>V1__.sql</code> is your first script, <code>V2__.sql</code>
is your second script and so on.</p><p>V1__.sql may look like:</p>
<pre class="prettyprint">
-- Just a simple table
create table GuestbookEntry (
    id int8 not null,
    email varchar(255),
    text varchar(255),
    primary key (id)
);

--needed for hibernate running on postgresql
create sequence hibernate_sequence;

</pre><p>A migration script is just plain old SQL. It is really important to stress that Flyway&rsquo;s migration
scripts are NOT database vendor independent. </p><p>Therefore it strongly discouraged to use different databases in test, dev and prod.</p><h1>Collaboratively working on migrations</h1><p>When two or more developers are working on the same script (let&rsquo;s say V2__.sql) they&rsquo;ll get
conflicts once they are trying to merge their changes.</p><p>But this is intentional and allows to fix problems in V2__.sql.
After resolving the issues and running your tests you can be confident
that your production upgrade will also work fine.</p><h1>Migrations in test, dev and prod</h1><p>In test mode Ninja automatically drops the schema and runs all migrations from scratch. In dev and production
migration scripts are executed automatically when they are detected. Usually this happens when the
first deployed Ninja instance connects with your database. Flyway&rsquo;s migrations are &ldquo;threadsafe&rdquo;. Therefore
nothing will go wrong when you are deploying 20 instances of your application that try to run the evolutions at
the same time.</p><h1>Flyway migrations versus Hibernate DDL</h1><p>Hibernate - the JPA implementation we are using is already providing a DDL (hbm2ddl) feature
that can manage and create &ldquo;migrations&rdquo; for you. </p><p>But Hibernate&rsquo;s hbm2ddl is &ldquo;just&rdquo; a diff tool.
Once your setup gets more complex Hibernate&rsquo;s feature is not enough.
Even the creators of Hibernate strongly discourage the usage in production systems:</p><p><strong>WARNING: We&rsquo;ve seen Hibernate users trying to use SchemaUpdate
to update the schema of a production database automatically.
This can quickly end in disaster and won&rsquo;t be allowed by your DBA.
(From the book Java Persistence with Hibernate).</strong></p><p>Our recommendation is to enable Hibernate&rsquo;s DDL for your first initial developments.</p><p>Enable that by setting the following properties inside your persistence unit (persistence.xml):</p>
<pre class="prettyprint">
&lt;property name=&quot;hibernate.hbm2ddl.auto&quot; value=&quot;create&quot; /&gt; 
&lt;property name=&quot;hibernate.show_sql&quot; value=&quot;true&quot; /&gt;
&lt;property name=&quot;hibernate.format_sql&quot; value=&quot;true&quot; /&gt;
</pre><p>Hint: Try using <strong>create</strong> (always drops data in your db) or <strong>update</strong> (tries to alter existing tables for
new data) for hibernate.hbm2ddl.auto.</p><p>Hibernate will then print out nice SQL statements for the creation of your tables, sequences and so on. </p><p>Once your initial prototype is ready copy them to your first migration (eg V1__.sql)
and deactivate Hibernate&rsquo;s DDL feature. From now on use Ninja&rsquo;s migrations and everything is safe.</p><h1>More</h1><p>Flyway offers a lot more. For instance Java based migrations, that really facilitate refactoring
of blobs. Check out Flyway&rsquo;s excellent site at: <a href="http://flywaydb.org">http://flywaydb.org</a></p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
